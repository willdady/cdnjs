!function(e){"use strict";var i=function(i){return i!=e},n=window.Visibility={onVisible:function(e){if(!n.isSupported()||!n.hidden())return e(),n.isSupported();var i=n.change(function(){n.hidden()||(n.unbind(i),e())});return i},change:function(e){if(!n.isSupported())return!1;n._lastId+=1;var i=n._lastId;return n._callbacks[i]=e,n._listen(),i},unbind:function(e){delete n._callbacks[e]},afterPrerendering:function(e){if(!n.isSupported()||"prerender"!=n.state())return e(),n.isSupported();var i=n.change(function(t,r){"prerender"!=r&&(n.unbind(i),e())});return i},hidden:function(){return n._prop("hidden",!1)},state:function(){return n._prop("visibilityState","visible")},isSupported:function(){return i(n._prefix())},_doc:window.document,_cached:null,_enable:!1,_lastId:-1,_callbacks:{},_wasHidden:!1,_init:function(){n._wasHidden=n.hidden()},_prefix:function(){return null!==n._cached?n._cached:i(n._doc.visibilityState)?n._cached="":i(n._doc.webkitVisibilityState)?n._cached="webkit":void 0},_name:function(e){var i=n._prefix();return""==i?e:i+e.substr(0,1).toUpperCase()+e.substr(1)},_prop:function(e,i){return n.isSupported()?n._doc[n._name(e)]:i},_change:function(e){var i=n.state();for(var t in n._callbacks)n._callbacks[t].call(n._doc,e,i);n._wasHidden=n.hidden()},_listen:function(){if(!n._enable){var e=n._prefix()+"visibilitychange",i=function(){n._change.apply(Visibility,arguments)};n._doc.addEventListener?n._doc.addEventListener(e,i,!1):n._doc.attachEvent(e,i),n._enable=!0,n._wasHidden=n.hidden()}}};n._init();var t={every:function(e,t,r){n._time(),i(r)||(r=t,t=null),n._lastTimer+=1;var a=n._lastTimer;return n._timers[a]={visible:e,hidden:t,callback:r},n._run(a,!1),n.isSupported()&&n._listen(),a},stop:function(e){var t=n._timers[e];return i(t)?(n._stop(e),delete n._timers[e],t):!1},_lastTimer:-1,_timers:{},_timed:!1,_time:function(){n._timed||(n._timed=!0,n.change(function(){n._stopRun()}))},_run:function(e,i){var t,r=n._timers[e];if(n.hidden()){if(null===r.hidden)return;t=r.hidden}else t=r.visible;var a=function(){r.last=new Date,r.callback.call(window)};if(i){var d=new Date,c=d-r.last;t>c?r.delay=setTimeout(function(){a(),r.id=setInterval(a,t)},t-c):(a(),r.id=setInterval(a,t))}else r.id=setInterval(a,t)},_stop:function(e){var i=n._timers[e];clearInterval(i.id),clearTimeout(i.delay),delete i.id,delete i.delay},_stopRun:function(){var e=n.hidden(),i=n._wasHidden;if(e&&!i||!e&&i)for(var t in n._timers)n._stop(t),n._run(t,!e)}};for(var r in t)Visibility[r]=t[r]}();