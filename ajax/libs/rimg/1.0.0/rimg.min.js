/*! http://github.com/joeyvandijk/rimg/ - 2013-11-29 */
"use strict";!function(){console||(alert("console not found"),console={log:function(){},error:function(){}}),Object.create||(Object.create=function(){function F(){}return function(o){if(1!=arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return F.prototype=o,new F}}()),Function.prototype.bind||(Function.prototype.bind=function(oThis){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};return fNOP.prototype=this.prototype,fBound.prototype=new fNOP,fBound});var Rimg=function(){function parseBreakpoints(value){if("string"==typeof value){var breakpoints=value.split(",");if(0===breakpoints.length)return hidden.status="error",console.error("Rimg: your breakpoint-definition "+value+" is invalid, check the documentation."),null;for(var definition=[],i=0,il=breakpoints.length;il>i;){for(var bp=breakpoints[i],bpDefinition={src:[],width:-1,height:-1,pixelRatio:[],getSrc:function(value){var ratios=this.pixelRatio.length;if(0===ratios)return hidden.status="error",console.error("Rimg: missing a pixelRatio definition, check the documentation."),"";if(1===ratios)return this.src[0];if(2===ratios)return 1>=value?this.src[0]:this.src[1];for(var s=0,sl=this.pixelRatio.length;sl>s;){if(value===this.pixelRatio[s]||Math.round(value)===this.pixelRatio[s])return this.src[s];s++}return this.src[ratios-1]}},parts=bp.split(" "),p=0,pl=parts.length;pl>p;){var part=parts[p];""===part.replace(" ","")||(null!==part.match(/^[0-9]{0,4}w/gi)?bpDefinition.width=Number(part.substr(0,part.length-1)):null!==part.match(/^[0-9]{0,4}h/gi)?bpDefinition.height=Number(part.substr(0,part.length-1)):null!==part.match(/[0-9]{1}x/gi)?bpDefinition.pixelRatio.push(Number(part.substr(0,part.length-1))):bpDefinition.src.push(part)),p++}for(var d=0,dl=definition.length,found=!1;dl>d;){var def=definition[d];if(def.width===bpDefinition.width&&-1!==def.width||def.height===bpDefinition.height&&-1!==def.height){def.pixelRatio.push(bpDefinition.pixelRatio[0]),def.src.push(bpDefinition.src[0]),found=!0;break}d++}found||definition.push(bpDefinition),i++}return definition.length>0?definition:(hidden.status="error",console.error("Rimg: your breakpoint-definition misses valid breakpoints, check the documentation."),null)}return hidden.status="error",console.error("Rimg: your breakpoint-definition is not a String, check the documentation."),null}function event(type,evt,func,target){void 0===target&&(target=document),"resize"===evt&&(target=window),hidden.isIE8?("DOMContentLoaded"===evt&&(evt="onreadystatechange"),"resize"===evt&&(evt="onresize"),"add"===type?target.attachEvent(evt,func):target.detachEvent(evt,func)):"add"===type?target.addEventListener(evt,func,!1):target.removeEventListener(evt,func,!1)}function adjust(value){var ratio=window.devicePixelRatio||1,data=value.getAttribute("data-src");if(null!==data){var file=data.substr(0,data.lastIndexOf(".")),extension=data.substr(data.lastIndexOf(".")),size={x:value.width,y:value.height};0===value.width&&(size.x=window.getComputedStyle(value,null).maxWidth,size.x=size.x.replace("px",""),size.x=Number(size.x)),0===value.height&&(size.y=window.getComputedStyle(value,null).maxHeight,size.y=size.y.replace("px",""),size.y=Number(size.y));for(var breakpoint,i=0,il=hidden.breakpoints.length;il>i;){var bp=hidden.breakpoints[i],wd=size.x;if(size.x<size.y,wd<=bp.width){breakpoint=bp;break}i++}void 0===breakpoint&&(breakpoint=hidden.breakpoints[hidden.breakpoints.length-1]),value.getAttribute("src")!==file+breakpoint.getSrc(ratio)+extension&&value.setAttribute("src",file+breakpoint.getSrc(ratio)+extension)}}function inspect(value){if("img"===value.nodeName.toLowerCase())adjust(value);else for(var i=0,il=value.children.length;il>i;){var item=value.children[i];inspect(item),i++}}function resize(){clearInterval(hidden.resizeWait);var nw=window.innerWidth+"x"+window.innerHeight;hidden.isIE8&&(nw=document.body.clientWidth+"x"+document.body.clientHeight),hidden.resizeDimensions!==nw&&(hidden.resizeDimensions=nw,this.execute(document)),hidden.time=(new Date).getTime()}function nodeInserted(e){this.execute(e.target)}var hidden={status:"init",observer:null,breakpoints:[],resizeWait:null,resizeDimensions:"",disableIntrospection:!1,isIE8:!1};if(void 0===window.addEventListener&&(alert("is IE8"),hidden.isIE8=!0),"undefined"!=typeof window.RimgBreakpoint){var bpts=parseBreakpoints(RimgBreakpoint);null!==bpts&&(hidden.breakpoints=bpts),window.RimgBreakpoint=void 0}else console.log("(remark) Rimg: no breakpoints defined (yet), check the documentation.");return{version:"1.0.0",execute:function(target){if("error"===hidden.status)return console.error("Rimg.execute(): error-status so no actions can be executed, check your code."),void 0;if(void 0===target)return console.error("Rimg.execute(): undefined value, check your code to add a valid DOM element to this function."),void 0;if("#document"===target.nodeName)if(target.childNodes.length>1){var html;if("HTML"!==target.childNodes[1].nodeName)for(var i=0,il=target.childNodes.length;il>i;){if("HTML"===target.childNodes[i].nodeName){html=target.childNodes[i];break}i++}else html=target.childNodes[1];if("BODY"!==html.childNodes[1].nodeName)for(var i=0,il=html.childNodes.length;il>i;){if("BODY"===html.childNodes[i].nodeName){inspect(html.childNodes[i]);break}i++}else inspect(html.childNodes[1])}else console.error("Rimg.execute(): not a valid DOM representation, check your code.");else void 0!==target&&void 0!==target.nodeName&&"img"===target.nodeName.toLowerCase()?inspect(target):void 0!==target[0]&&"img"===target[0].nodeName.toLowerCase()&&inspect(target[0])},configure:function(value){var breakpoints=parseBreakpoints(value);null!==breakpoints&&(hidden.breakpoints=breakpoints),"ready"!==hidden.status||hidden.disableIntrospection||this.execute(document)},resized:function(){"ready"===hidden.status&&(null!==hidden.resizeWait&&clearInterval(hidden.resizeWait),void 0===hidden.time||(new Date).getTime()-hidden.time>1e3?resize.bind(this)():hidden.resizeWait=setInterval(resize.bind(this),100))},loaded:function(e){"progress"===hidden.status&&(hidden.isIE8&&"complete"!=document.readyState||(event("remove","DOMContentLoaded",this.loaded),hidden.disableIntrospection||(null===hidden.observer?(hidden.isIE8&&(e.target=document),this.execute(e.target)):(hidden.observer.observe(document.body,{attributes:!0,childList:!0,characterData:!1,subtree:!0,attributeFilter:["data-src"]}),this.execute(document)),event("add","resize",this.resized.bind(this))),hidden.status="ready"))},disableIntrospection:function(){hidden.disableIntrospection=!0,hidden.observer?hidden.observer.disconnect():event("remove","DOMNodeInserted",nodeInserted)},initialize:function(){if("init"!==hidden.status)return"error"!==hidden.status&&console.error("Rimg.initialize(): Already initialized. No forced initialization supported, check your code."),void 0;var base=this,MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;void 0===MutationObserver||hidden.isIE8?(event("add","DOMAttrModified",function(e){base.execute(e.target)}),event("add","DOMNodeInserted",nodeInserted.bind(base))):hidden.observer=new MutationObserver(function(mutations){mutations.forEach(function(mutation){mutation.addedNodes.length>0?base.execute(mutation.addedNodes):"data-src"===mutation.attributeName&&base.execute(mutation.target)})}),hidden.status="progress",event("add","DOMContentLoaded",this.loaded.bind(this))}}};window.Rimg=Object.create(Rimg()),window.Rimg.initialize()}();